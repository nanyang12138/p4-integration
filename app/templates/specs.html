{% extends "layout.html" %}
{% block content %}
<h3>Branch Specs</h3>
<table>
  <thead>
    <tr><th>Name</th><th>Source</th><th>Target</th><th>Description</th><th></th></tr>
  </thead>
  <tbody>
    {% for name, sp in specs.items() %}
    <tr>
      <td><code>{{ name }}</code></td>
      <td><code>{{ sp.source }}</code></td>
      <td><code>{{ sp.target }}</code></td>
      <td>{{ sp.description or '' }}</td>
      <td>
        {% if is_admin %}
        <form method="post" action="/api/specs/{{ name }}/delete" onsubmit="return confirm('Delete spec {{ name }}?');">
          <button class="btn btn-danger" type="submit">Delete</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% if is_admin %}
<h3>Add Spec</h3>
<form id="add-spec-form" onsubmit="return addSpec(event)">
  <div><label>Name</label><br/><input type="text" name="name" style="width:100%" required /></div>
  <div><label>Source</label><br/><input type="text" name="source" style="width:100%" required /></div>
  <div><label>Target</label><br/><input type="text" name="target" style="width:100%" required /></div>
  <div><label>Description</label><br/><input type="text" name="description" style="width:100%" /></div>
  <div style="margin-top:8px;"><button class="btn btn-primary" type="submit">Add</button></div>
</form>
<script>
async function addSpec(ev){
  ev.preventDefault();
  const f = document.getElementById('add-spec-form');
  const body = {
    name: f.name.value.trim(),
    source: f.source.value.trim(),
    target: f.target.value.trim(),
    description: f.description.value.trim()
  };
  const resp = await fetch('/api/specs', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
  if(resp.ok){ location.reload(); } else { alert('Add failed'); }
}
</script>
{% endif %}
{% endblock %}


